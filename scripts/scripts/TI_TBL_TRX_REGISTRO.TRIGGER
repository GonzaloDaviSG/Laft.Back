CREATE OR REPLACE  TRIGGER LAFT.TI_TBL_TRX_REGISTRO
BEFORE INSERT
   ON LAFT.TBL_TRX_REGISTRO
   FOR EACH ROW
DECLARE
BEGIN
    IF :NEW.NID IS NULL THEN
        SELECT SEQ_TBL_TRX_REGISTRO.NEXTVAL
        INTO :NEW.NID
        FROM DUAL;
    END IF;
    
    :NEW.DREGISTRO := SYSDATE;
    :NEW.NEDITADO := 0;
    
    INSERT INTO LAFT.TBL_HIS_REGISTRO(NID,NSEQ,SNUMERO,NIDCARGA,NIDPERSONA,SPERSONA,NIDPAIS,SPAIS,
                                NIDSENIAL,SSENIAL,NIDDOCUMENTO,SDOCUMENTO,SNUMDOC,
                                SAPEPAT,SAPEMAT,SNOMBRE,SOBSERVACION,DREGISTRO,SUSUARIO,NESTADO,NEDITADO,
                                SUSERDB,SUSERPC,SIP,SHOST,DREGHIS,STIPHIS)
    VALUES(:NEW.NID,:NEW.NSEQ,:NEW.SNUMERO,:NEW.NIDCARGA,:NEW.NIDPERSONA,:NEW.SPERSONA,:NEW.NIDPAIS,:NEW.SPAIS,
            :NEW.NIDSENIAL,:NEW.SSENIAL,:NEW.NIDDOCUMENTO,:NEW.SDOCUMENTO,:NEW.SNUMDOC,
            :NEW.SAPEPAT,:NEW.SAPEMAT,:NEW.SNOMBRE,:NEW.SOBSERVACION,:NEW.DREGISTRO,:NEW.SUSUARIO,:NEW.NESTADO,:NEW.NEDITADO,
            SYS_CONTEXT('USERENV','SESSION_USER'),SYS_CONTEXT('USERENV','OS_USER'),SYS_CONTEXT('USERENV','IP_ADDRESS'),SYS_CONTEXT('USERENV','HOST'),SYSDATE  ,'I');

END;
